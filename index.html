<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-128479674-2', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://kaichu.se/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://kaichu.se"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-what-is-apache-airflow" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/07/what-is-apache-airflow/" class="article-date">
  <time datetime="2020-08-06T22:06:06.000Z" itemprop="datePublished">2020-08-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Airflow/">Airflow</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/07/what-is-apache-airflow/">What is apache airflow</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="What-is-airflow"><a href="#What-is-airflow" class="headerlink" title="What is airflow"></a>What is airflow</h2><p>Airflow is an clustered platform to schedule, run-through and monitor a series of tasks in a directed acyclic graph (DAGs).<br>It gives better management capabilities to create, log and link jobs what would be done by cron jobs.</p>
<h2 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h2><p>Airflow cluster setup will have webserver, scheduler, message broker and worker components as following.<br><img src="/assets/airflow/airflow_arc.jpg" alt="Airflow arc"><br>Webserver serves UI and scheduler will parse tasks defintion, the DAGs from Airflow Home folder, usually airflow maintainer<br>will deploy their DAGs definition there and scheduler will parse them and add meta data in to the meta DB.<br>Each DAG will be given a trigger time, which is similar as cron, then it’s met, scheduler will put the task into broker and one of the workers<br>will pick up that task and run it. Workers will work on tasks while following the dependencies defined in the DAG. </p>
<h2 id="Concepts-to-understand-before-start"><a href="#Concepts-to-understand-before-start" class="headerlink" title="Concepts to understand before start"></a>Concepts to understand before start</h2><h3 id="DAG"><a href="#DAG" class="headerlink" title="DAG"></a>DAG</h3><p>Directed Acyclic Graph – is a workflow of all the tasks you want to run, organized in a way that reflects their relationships and dependencies In general, each one should correspond to a single logical workflow</p>
<h3 id="DAG-definition"><a href="#DAG-definition" class="headerlink" title="DAG definition"></a>DAG definition</h3><p>Airflow use python file to declare dag objects, a DAG function is provided to accept configurations. e.g. dag=DAG(‘dag_name’, default_args=default_args)</p>
<ul>
<li>Dag arguments<br>The arguments provided for the dag object when the dag is run</li>
<li>Dag default arguments<br>The default dag argument, which is provided when defining the dag in dag definition python file</li>
<li>Context manager<br>airflow will find a dag definition in a python and assign that dat to operators defined in that definition file</li>
<li>Dag objects build<br>Airflow will find and run dag definition python files to create dags</li>
<li>Task relationship<br>Tasks a a dag can has dependencies by using task_1 &gt;&gt; task_2, the same as task_1.set_downstream(task_2)</li>
<li>Bitshift Composition<br>A convinient way to define relationships between tasks. &gt;&gt;</li>
<li>Upstream<br>if we have a taskA, then the task running before it is the upstream of taskA, task A need to wait until upstream has completed successfully.</li>
<li>Downsteam<br>if we have a taskA, then the task after it is the downstream of taskA</li>
</ul>
<h3 id="Dagbag"><a href="#Dagbag" class="headerlink" title="Dagbag"></a>Dagbag</h3><p>A folder where airflow is searching DAG definition python files, execute and build DAG objects into airflow system.<br>When searching for DAGs, Airflow only considers python files that contain the strings “airflow” and “DAG” by default.<br>To consider all python files instead, disable the DAG_DISCOVERY_SAFE_MODE configuration flag.</p>
<h3 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h3><p>A work unit in a DAG, it is an implementation of an Operator. for example a PythonOperator to execute some Python code, or a BashOperator to run a Bash command</p>
<h3 id="Task-instance"><a href="#Task-instance" class="headerlink" title="Task instance"></a>Task instance</h3><p>A runtime exection of a task, It should be a combination of a DAG, a task, and a point in time (execution_date)</p>
<h3 id="Task-lifecycle"><a href="#Task-lifecycle" class="headerlink" title="Task lifecycle"></a>Task lifecycle</h3><p>A task goes through various stages from start to completion<br><img src="https://airflow.apache.org/docs/stable/_images/task_lifecycle_diagram.png" alt="Airflow lifecycle"></p>
<h3 id="Operators"><a href="#Operators" class="headerlink" title="Operators"></a>Operators</h3><p>Operators is specific implementations of tasks. It defines what the task does and are only loaded by Airflow if they are assigned to a DAG.<br>e.g.<br>BashOperator - executes a bash command<br>PythonOperator - calls an arbitrary Python function<br>EmailOperator - sends an email<br>SimpleHttpOperator - sends an HTTP request</p>
<h3 id="Pool"><a href="#Pool" class="headerlink" title="Pool"></a>Pool</h3><p>A named of list of workers which can be refered by a task to manually balance airflow workload.</p>
<h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><p>Queue for a executor to cache tasks</p>
<h3 id="Worker"><a href="#Worker" class="headerlink" title="Worker"></a>Worker</h3><p>Processes to get tasks out from queue and run it, workers can listen to one or multiple queues of tasks. </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kaichu.se/2020/08/07/what-is-apache-airflow/" data-id="ckdjv320e0011p2c94sto6iln" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/architecture/" rel="tag">architecture</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bigdata/" rel="tag">bigdata</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/datalake/" rel="tag">datalake</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-understand-different-levels-of-hypervisors-beneath-os" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/12/understand-different-levels-of-hypervisors-beneath-os/" class="article-date">
  <time datetime="2020-05-11T22:18:36.000Z" itemprop="datePublished">2020-05-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/OS/">OS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/12/understand-different-levels-of-hypervisors-beneath-os/">Understand different levels of hypervisors beneath os</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I have chosen the word ‘beneath os’ instead of ‘on top of hardware’ for describing hypervisors. It will remind of me that hypervisors were born as an abstraction level between an os and the actual hardware devices. A notice of qemu in kvm leads me to try to understand the differences in bewtween.</p>
<p><img src="/assets/hypervisors.jpg" alt="hypervisor diagram"></p>
<h1 id="Hosted-hypervisor-type-2"><a href="#Hosted-hypervisor-type-2" class="headerlink" title="Hosted hypervisor(type 2)"></a>Hosted hypervisor(type 2)</h1><p>It is an application running on top of another os(named host os), it runs as a process on the host.<br>It’s kind of os software to emulate other system commands and translate or adapte them into host os commands, utilizing host os drivers to communicate with hardwares. (No hardware involved)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">guest os -&gt; type2 hypervisor -&gt; host os -&gt; hardware</span><br></pre></td></tr></table></figure>

<h1 id="Native-Hypervisor-type-1"><a href="#Native-Hypervisor-type-1" class="headerlink" title="Native Hypervisor(type 1)"></a>Native Hypervisor(type 1)</h1><p>Also called native or bare-metal hypervisor, is <em>virtualization software</em> that is installed on hardware directly.<br>It requires a processor with hardware virtualization extensions, such as Intel VT or AMD-V, to help to translate or map instructions to hardware cpu</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">guest os -&gt; type1 hypervisor -&gt; hardware</span><br></pre></td></tr></table></figure>

<p>KVM is a type 1 hypervisor and Qemu is a Type 2 hypervisor. </p>
<p>Type 1 hypervisor comes installed with the hardware system like KVM in Linux. KVM provides hardware acceleration for virtual machines but it need Qemu to emulate any operating system.</p>
<p>Qemu is a Type 2 hypverisor, it can be installed on an operating system and it runs as an indepent process and the instructions we give in Quemu will be executed on the host machine. Qemu can run independently without KVM as its a emulator however the performance will be poor as Qemu doesnt do any hardware acceleration</p>
<p>There is a project that is on-going to integrate Qemu and KVM. This will be a type 1 hypervisor. So we will have all the benefits of Qemu as an emulator and KVM hardware acceleration for better performance.</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Hypervisor">Wiki hypervisor</a></li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine">Kernel based virtual machine</a></li>
<li><a target="_blank" rel="noopener" href="http://www.linux-kvm.org/page/FAQ#General_KVM_information">linux-kvm org</a></li>
<li><a target="_blank" rel="noopener" href="https://www.quora.com/Virtualization-What-is-the-difference-between-KVM-and-QEMU">Quora difference between kvm and qemu</a></li>
<li><a target="_blank" rel="noopener" href="http://cseweb.ucsd.edu/~jfisherogden/hardwareVirt.pdf">UCSD hardwareVirt paper</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kaichu.se/2020/05/12/understand-different-levels-of-hypervisors-beneath-os/" data-id="ckdjv320d000yp2c9h2kr3y42" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hypervisors/" rel="tag">hypervisors</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kvm/" rel="tag">kvm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qemu/" rel="tag">qemu</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/virtulization/" rel="tag">virtulization</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-start-a-nodejs-project-and-publish-it-into-public-npm-registry" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/01/start-a-nodejs-project-and-publish-it-into-public-npm-registry/" class="article-date">
  <time datetime="2020-05-01T19:56:21.000Z" itemprop="datePublished">2020-05-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Nodejs/">Nodejs</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/01/start-a-nodejs-project-and-publish-it-into-public-npm-registry/">Start a nodejs project and publish it into public npm registry</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is all about the basic steps to start a npm project and publish it into <a target="_blank" rel="noopener" href="https://www.npmjs.com/">npmjs</a></p>
<p>Npmjs is a public npm registry which is managing packages. Anyone can register an account and publish his or her package to share with others. It’s free if you are only about publishing publich packages and can be accessed by anyone. Paid features can be found <a target="_blank" rel="noopener" href="https://www.npmjs.com/products">here</a></p>
<h2 id="Register-an-account"><a href="#Register-an-account" class="headerlink" title="Register an account"></a>Register an account</h2><p>To manage your own packages, an account is required in <a target="_blank" rel="noopener" href="https://www.npmjs.com/">npmjs</a></p>
<h2 id="Create-a-project"><a href="#Create-a-project" class="headerlink" title="Create a project"></a>Create a project</h2><p>Simply create a folder in your local machine and run npm init to start a npm project</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir node_starter &amp;&amp; <span class="built_in">cd</span> node_starter</span><br><span class="line">node_starter$ npm init --scope=kaichu</span><br><span class="line"></span><br><span class="line">package name: (@kaichu/node_starter) </span><br><span class="line">version: (1.0.0) </span><br><span class="line">git repository: </span><br><span class="line">keywords: </span><br><span class="line">license: (ISC) </span><br><span class="line">About to write to /Users/kaichu/Workspace/Dev/js/poc/node_in_deep/node_starter/package.json:</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;@kaichu/node_starter&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;A starter demo&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;Kai Chu&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Create-the-index-js-file"><a href="#Create-the-index-js-file" class="headerlink" title="Create the index.js file"></a>Create the index.js file</h2><p>which is the main entrypoint of the package as specified in the package key “main”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node_starter$ touch index.js</span><br><span class="line">node_starter$ <span class="built_in">echo</span> <span class="string">&#x27;console.log(&quot;hi nodejs&quot;)&#x27;</span> &gt;&gt; index.js</span><br></pre></td></tr></table></figure>

<h2 id="Login-the-registry-from-command"><a href="#Login-the-registry-from-command" class="headerlink" title="Login the registry from command"></a>Login the registry from command</h2><p>Looks good enough to try out the publish, before a publish, you need to login the the registy in your local command. Run following command and fill in your username and password you have setup in the Step 1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm login</span><br></pre></td></tr></table></figure>
<blockquote>
<p>which actually create a authToken in your home ~/.npmrc file</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~&#x2F;.npmrc </span><br><span class="line">&#x2F;&#x2F;registry.npmjs.org&#x2F;:_authToken&#x3D;&quot;xxxxx-xxxx-xxx&quot;</span><br></pre></td></tr></table></figure>

<h2 id="Publish-your-first-npm-package"><a href="#Publish-your-first-npm-package" class="headerlink" title="Publish your first npm package"></a>Publish your first npm package</h2><p>Make sure you are in the node_starter dir and run publich. the –access will tell npm registry if it’s a public or restricted package.<br>Since we are not paying, only public options are useful.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm publish --access&#x3D;public</span><br></pre></td></tr></table></figure>

<h2 id="Check-the-published-result"><a href="#Check-the-published-result" class="headerlink" title="Check the published result"></a>Check the published result</h2><p>You should have got an email and tell you haved published your package Go to npm regisry and </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;Email</span><br><span class="line">Successfully published @kaichu&#x2F;node_starter@1.0.0</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Npm registry </span><br><span class="line">Click your profile pic -&gt; packages, node_starter is ready for you there.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/assets/npm_packages.png" alt="NPM packages"></p>
<h2 id="Use-your-package"><a href="#Use-your-package" class="headerlink" title="Use your package"></a>Use your package</h2><p>Since the package is published in npm registery, now you can use your <code>npm i</code> to install it. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ npm i @kaichu/node_starter</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">## Tag your published package</span></span><br><span class="line">When publishing a package, npm will add a tag `latest` to your package <span class="built_in">which</span> can be seen <span class="keyword">in</span> npmjs as following</span><br><span class="line">![Latest tag default](/assets/npm_before_tag.png)</span><br><span class="line"></span><br><span class="line">When publish packages, we can add extra options --tag to add new tag to a publish. </span><br><span class="line">```bash</span><br><span class="line">npm publish --access=public --tag=dev</span><br></pre></td></tr></table></figure>

<p>However, since we have publihed the package, in default, we cannot publish the same version again. We can use<br>another separate npm cli to add dev tag.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm dist-tag add @kaichu&#x2F;node_starter@1.0.0 dev</span><br><span class="line">$ npm dist-tag ls @kaichu&#x2F;node_starter@1.0.0</span><br></pre></td></tr></table></figure>
<p>The result will be shown in npmjs as well.<br><img src="/assets/npm_after_tag.png" alt="Latest tag default"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@kaichu/node_starter">my node_starter</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kaichu.se/2020/05/01/start-a-nodejs-project-and-publish-it-into-public-npm-registry/" data-id="ckdjv320b000tp2c994jzhmhr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/starter/" rel="tag">starter</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-setup-airflow-with-openldap-authentication-with-docker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/25/setup-airflow-with-openldap-authentication-with-docker/" class="article-date">
  <time datetime="2020-04-24T22:10:16.000Z" itemprop="datePublished">2020-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Airflow/">Airflow</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/25/setup-airflow-with-openldap-authentication-with-docker/">Setup airflow with openldap authentication with docker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Airflow provides a few ways to add authentication. <a target="_blank" rel="noopener" href="https://airflow.apache.org/docs/stable/security.html">https://airflow.apache.org/docs/stable/security.html</a><br>In this post, I want to demo how to setup a ldap server with docker and airflow to use that ldap.</p>
<p>1 Setup openldap using docker image, remember to enable LDAP_RFC2307BIS_SCHEMA, which will bring in the groupOfNames, posixGroup schema definition</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -p 389:389 -p 636:636 -v C:\Users\kach07:&#x2F;ldap \</span><br><span class="line">--env LDAP_RFC2307BIS_SCHEMA&#x3D;true  \</span><br><span class="line">--name my-openldap-container \</span><br><span class="line">--detach \</span><br><span class="line">osixia&#x2F;openldap:1.3.0</span><br></pre></td></tr></table></figure>
<p>2 Create two files and put them in you home folder so that you can find them inside the container C:\Users\kach07<br>I’m lazy, I have mapped the whole home dir to my container. Alternatively, you can you docker cp to move files into your container.</p>
<ul>
<li><p>group.ldif</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dn: cn&#x3D;airflow-super-users,dc&#x3D;example,dc&#x3D;org</span><br><span class="line">cn: airflow-super-users</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: groupOfNames</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">member: uid&#x3D;test_user,dc&#x3D;example,dc&#x3D;org</span><br><span class="line">gidNumber: 100</span><br><span class="line">memberUid: test_user</span><br></pre></td></tr></table></figure>
</li>
<li><p>user.ldif</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dn: uid&#x3D;test_user,dc&#x3D;example,dc&#x3D;org</span><br><span class="line">uid: test_user</span><br><span class="line">sn: User</span><br><span class="line">cn: Test User</span><br><span class="line">objectClass: person</span><br><span class="line">objectClass: organizationalPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">loginShell: &#x2F;bin&#x2F;bash</span><br><span class="line">homeDirectory: &#x2F;home&#x2F;testuser</span><br><span class="line">uidNumber: 1001</span><br><span class="line">gidNumber: 1001</span><br></pre></td></tr></table></figure></li>
<li><p>You can chagne the password for your test_user [Commands are running inside your container]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec -it my-openldap-container &#x2F;bin&#x2F;bash</span><br><span class="line">$ ldappasswd -x -H ldap:&#x2F;&#x2F;localhost -D &quot;cn&#x3D;admin,dc&#x3D;example,dc&#x3D;org&quot; -w admin -S -ZZ uid&#x3D;test_user,dc&#x3D;example,dc&#x3D;org</span><br></pre></td></tr></table></figure>
<p>or </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec my-openldap-container \</span><br><span class="line"> ldappasswd -x -H ldap:&#x2F;&#x2F;localhost -D &quot;cn&#x3D;admin,dc&#x3D;example,dc&#x3D;org&quot; -w admin -S -ZZ uid&#x3D;test_user,dc&#x3D;example,dc&#x3D;org</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>3 Go into the container to use ldapadd command to add user and group entries [Commands are running inside your container]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec -it my-openldap-container &#x2F;bin&#x2F;bash</span><br><span class="line">$ cd &#x2F;ldap</span><br><span class="line">$ ldapadd -x -H ldap:&#x2F;&#x2F;localhost -w admin -D &#39;cn&#x3D;admin,dc&#x3D;example,dc&#x3D;org&#39; -f &#x2F;ldap&#x2F;user.ldif</span><br><span class="line">$ ldapadd -x -H ldap:&#x2F;&#x2F;localhost -w admin -D &#39;cn&#x3D;admin,dc&#x3D;example,dc&#x3D;org&#39; -f &#x2F;ldap&#x2F;group.ldif</span><br></pre></td></tr></table></figure>
<p>4 Check you container ip [], if you are running in linux, you can your docker run –network host to skip this part. I’m lazy to add network for two containers, and use the ip later in airflow to connect to the ldap server.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect my-openldap-container --format&#x3D;&#39;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#39;</span><br><span class="line">&#x2F;&#x2F;my output &#x3D;&gt;  172.17.0.2</span><br></pre></td></tr></table></figure>

<p>5 Change config in your airflow.cfg </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[webserver]</span><br><span class="line">authenticate &#x3D; True</span><br><span class="line">auth_backend &#x3D; airflow.contrib.auth.backends.ldap_auth</span><br><span class="line"></span><br><span class="line">[ldap]</span><br><span class="line"># set this to ldaps:&#x2F;&#x2F;&lt;your.ldap.server&gt;:&lt;port&gt;</span><br><span class="line">uri &#x3D;ldap:&#x2F;&#x2F;172.17.0.2:389</span><br><span class="line">user_filter &#x3D; objectClass&#x3D;*</span><br><span class="line">user_name_attr &#x3D; uid</span><br><span class="line">group_member_attr &#x3D; memberOf</span><br><span class="line">superuser_filter &#x3D; memberOf&#x3D;CN&#x3D;airflow-super-users,dc&#x3D;example,dc&#x3D;org</span><br><span class="line">data_profiler_filter &#x3D;</span><br><span class="line">bind_user &#x3D; cn&#x3D;admin,dc&#x3D;example,dc&#x3D;org</span><br><span class="line">bind_password &#x3D; admin</span><br><span class="line">basedn &#x3D; dc&#x3D;example,dc&#x3D;org</span><br><span class="line"># You cannot comment it out, explicitly use cacert&#x3D; is important</span><br><span class="line">cacert &#x3D;</span><br><span class="line">search_scope &#x3D; LEVEL</span><br></pre></td></tr></table></figure>
<p>6 Start your airflow docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run  --mount type&#x3D;bind,source&#x3D;&quot;C:&#x2F;Users&#x2F;kach07&#x2F;airflow&#x2F;airflow.cfg&quot;,target&#x3D;&#x2F;usr&#x2F;local&#x2F;airflow&#x2F;airflow.cfg -p 8080:8080 testairflow webserver</span><br></pre></td></tr></table></figure>
<p>I have built my own local container, since airflow.contrib.auth.backends.ldap_auth requires ldap3 and airflow[ldap] module</p>
<p>7 Open you airflow in browser, you shall be asked to input your password. Use the user test_user and password you setup to login.<br><a target="_blank" rel="noopener" href="http://localhost:8080/admin">http://localhost:8080/admin</a> </p>
<p>8 More things to say</p>
<ul>
<li><p>Others: if you want to play around ldapsearch in your command<br>ldapsearch -xLLL -H ldap://localhost -w admin -D ‘cn=admin,dc=example,dc=org’ -b dc=example,dc=org cn=*</p>
</li>
<li><p>Important:<br>Don’t add any quote in your configurations, I have # in my password, then I decide to use an env to test my setup </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run  --mount type&#x3D;bind,source&#x3D;&quot;C:&#x2F;Users&#x2F;kach07&#x2F;airflow&#x2F;airflow.cfg&quot;,target&#x3D;&#x2F;usr&#x2F;local&#x2F;airflow&#x2F;airflow.cfg --env </span><br><span class="line">&quot;AIRFLOW__LDAP__BIND_PASSWORD&#x3D;Fw5Mk#Sr&quot; -p 8080:8080 testairflow webserver</span><br></pre></td></tr></table></figure>
</li>
<li><p>For AD Users</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user_name_attr &#x3D; sAMAccountName</span><br><span class="line">search_scope &#x3D; SUBTREE</span><br></pre></td></tr></table></figure>

</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kaichu.se/2020/04/25/setup-airflow-with-openldap-authentication-with-docker/" data-id="ckdjv320a000qp2c9834qbawo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/airflow/" rel="tag">airflow</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openldap/" rel="tag">openldap</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-start-a-ansible-project" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/24/start-a-ansible-project/" class="article-date">
  <time datetime="2020-04-24T07:15:36.000Z" itemprop="datePublished">2020-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Ansible/">Ansible</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/24/start-a-ansible-project/">Start a ansible project</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>Create a folder to hold all your files<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir ansible-project</span><br></pre></td></tr></table></figure></li>
<li>Add hosts file<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ touch hosts</span><br><span class="line">$ vi hosts</span><br><span class="line">abc[1:4].example.domain</span><br></pre></td></tr></table></figure></li>
<li>Add ansible.cfg file<br>Create a template in project folder and copy it to your home folder so that other won’t operate it by mistake, regarding configurations can be refered <a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html">https://docs.ansible.com/ansible/latest/reference_appendices/config.html</a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ touch ansible.cfg.template</span><br><span class="line">[remote_user]</span><br><span class="line">YOUR_USER_NAME</span><br><span class="line">$ copy ansible.cfg.template ~&#x2F;.ansbile.cfg</span><br></pre></td></tr></table></figure></li>
<li>Run ping to test connection<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible -i hosts all -k -m ping</span><br></pre></td></tr></table></figure></li>
<li>Add vars or vaults <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir vars &amp;&amp; cd vars</span><br><span class="line">ansible-vault create vaults.yml </span><br><span class="line">touch vars.yml</span><br></pre></td></tr></table></figure></li>
<li>Add main.yml <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- hosts: all</span><br><span class="line">  vars_files:</span><br><span class="line">    - vars&#x2F;vars.yml</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Push dags to remote </span><br><span class="line">      taskName:</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kaichu.se/2020/04/24/start-a-ansible-project/" data-id="ckdjv3208000mp2c90e0n5xti" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ansible/" rel="tag">ansible</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-using-airflow-jinja-to-render-a-template-with-your-own-context" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/21/using-airflow-jinja-to-render-a-template-with-your-own-context/" class="article-date">
  <time datetime="2020-04-21T17:02:32.000Z" itemprop="datePublished">2020-04-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Airflow/">Airflow</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/21/using-airflow-jinja-to-render-a-template-with-your-own-context/">Using airflow jinja to render a template with your own context</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Jinja is well explained when using with operators which has support for a template field. It could be a bash_command parameters in a BashOperator as following</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">templated_command &#x3D; &quot;&quot;&quot;</span><br><span class="line">&#123;% for i in range(5) %&#125;</span><br><span class="line">    echo &quot;&#123;&#123; ds &#125;&#125;&quot;</span><br><span class="line">    echo &quot;&#123;&#123; macros.ds_add(ds, 7)&#125;&#125;&quot;</span><br><span class="line">    echo &quot;&#123;&#123; params.my_param &#125;&#125;&quot;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">t3 &#x3D; BashOperator(</span><br><span class="line">    task_id&#x3D;&#39;templated&#39;,</span><br><span class="line">    depends_on_past&#x3D;False,</span><br><span class="line">    bash_command&#x3D;templated_command,</span><br><span class="line">    params&#x3D;&#123;&#39;my_param&#39;: &#39;Parameter I passed in&#39;&#125;,</span><br><span class="line">    dag&#x3D;dag,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>Using jinja template in a op_args or op_kwargs in a python operator<br>def my_sleeping_function(**context):<br>    # here context.random_base will be the actual execution_date, e.g. 2020-02-20</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">task &#x3D; PythonOperator(</span><br><span class="line">    task_id&#x3D;&#39;sleep&#39;</span><br><span class="line">    python_callable&#x3D;my_sleeping_function,</span><br><span class="line">    op_kwargs&#x3D;&#123;&#39;random_base&#39;: &#39;&#123;&#123;ds&#125;&#125;&#39;&#125;,</span><br><span class="line">    dag&#x3D;dag,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>however, if you have a python code where you want to render your own variables, you can using following method from helpers module.<br>There is an helper method which is built on top of jinja in airflow, you can import it in your dag file</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from airflow.utils.helpers import parse_template_string</span><br></pre></td></tr></table></figure>

<p>Suppose you have a template string in your dag definition, however, you only know the context when the dag task is running.<br>For example, the execution_date which is provided in context.ds<br>Then you can use parse_template_string method to get a template and use the render with context to get your filename as following</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">filename_template&#x3D;&#39;abc-&#123;&#123;ds&#125;&#125;.csv&#39;</span><br><span class="line"></span><br><span class="line">def my_sleeping_function(**context):</span><br><span class="line">  filename_template, filename_jinja_template &#x3D; parse_template_string(filename_template)</span><br><span class="line">  filename &#x3D; filename_jinja_template.render(**context)</span><br><span class="line"></span><br><span class="line">task &#x3D; PythonOperator(</span><br><span class="line">    task_id&#x3D;&#39;sleep&#39;</span><br><span class="line">    python_callable&#x3D;my_sleeping_function,</span><br><span class="line">    op_kwargs&#x3D;&#123;&#39;random_base&#39;: &#39;&#123;&#123;ds&#125;&#125;&#39;&#125;,</span><br><span class="line">    dag&#x3D;dag,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://kaichu.se/2020/04/21/using-airflow-jinja-to-render-a-template-with-your-own-context/" data-id="ckdjv3207000lp2c9a56263ho" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jinja/" rel="tag">jinja</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-airflow-execution-time-and-dag-parsing-time" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/08/airflow-execution-time-and-dag-parsing-time/" class="article-date">
  <time datetime="2020-04-08T12:28:39.000Z" itemprop="datePublished">2020-04-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Airflow/">Airflow</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/08/airflow-execution-time-and-dag-parsing-time/">Understand airflow execution time and dag parsing time</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Airflow dags are written in python, there are actually two runtimes for the same codes. Firstly, airflow will parse the dags and create metadata in the database<br>And then when execution time is met, worker will run the python codes to do the actual schedule work.</p>
<p>Don’t mix them when writting a airflow dag. I’ll have a small example to tell the differences in between.</p>
<p>In this example, I want to demo how it is important for developers to keep that in mind.<br>Usually, when we create a dag, we need to give a paramerter so that we can reuse it in different environments without changing the code.<br>It is implemented by using variables.<br>In the following case, I want to get the python pip version and show it when the dag is executed.<br>I have printed in two places. One is the root level and the other one is in the python operator’s callable function.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;demo-airflow-capability.py</span><br><span class="line">import os</span><br><span class="line">...</span><br><span class="line">print(os.environ[&#39;PYTHON_PIP_VERSION&#39;])</span><br><span class="line"></span><br><span class="line">def print_env():</span><br><span class="line">    print(os.environ[&#39;PYTHON_PIP_VERSION&#39;])</span><br><span class="line"></span><br><span class="line">with dag:</span><br><span class="line">    os_operator &#x3D; PythonOperator(task_id &#x3D; &quot;os_operator&quot;, python_callable&#x3D;print_env)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>As we know, we can use python demo-airflow-capability.py to validate the syntax, which is also how the parse does.<br>The python version is printed pip version is shown once when parsed</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python demo-airflow-capability.py</span><br><span class="line">&#39;20.0.2&#39;</span><br></pre></td></tr></table></figure>

<p>When we trigger the dag to be executed, you will find the python pip version <code>&#39;20.0.2&#39;</code> is printed once as well.<br>That is from the python operator.<br>To test a dag execution, we can use the command from airflow cli</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ airflow test demo-airflow-capability os_operator -e 2020-04-08</span><br></pre></td></tr></table></figure>

<p>Conclusion:</p>
<ol>
<li>The same dag file will be parsed and executed in two different places with different logic routines.</li>
<li>Think dag file as a main entry of parser</li>
<li>Think root operator of the dependency tree as a main entry of executor</li>
<li>Keep time consuming operations out of dag parsing phase, such as fetching <a target="_blank" rel="noopener" href="https://airflow.apache.org/docs/stable/best-practices.html#variables">variables</a></li>
</ol>
<p>Appendix:</p>
<p>Dag file demo-airflow-capability.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">from airflow.utils.dates import days_ago</span><br><span class="line">from airflow.models import DAG</span><br><span class="line">from airflow.operators.python_operator import PythonOperator</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">args &#x3D; &#123;</span><br><span class="line">    &#39;owner&#39;: &#39;airflow&#39;,</span><br><span class="line">    &#39;start_date&#39;: days_ago(2),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dag &#x3D; DAG(</span><br><span class="line">    dag_id&#x3D;&#39;demo-airflow-capability&#39;,</span><br><span class="line">    default_args&#x3D;args,</span><br><span class="line">    schedule_interval&#x3D;&quot;@once&quot;,</span><br><span class="line">    tags&#x3D;[&#39;example&#39;]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(os.environ[&#39;PYTHON_PIP_VERSION&#39;])</span><br><span class="line"></span><br><span class="line">def print_env():</span><br><span class="line">    print(os.environ[&#39;PYTHON_PIP_VERSION&#39;])</span><br><span class="line"></span><br><span class="line">with dag:</span><br><span class="line">    os_operator &#x3D; PythonOperator(task_id &#x3D; &quot;os_operator&quot;, python_callable&#x3D;print_env)</span><br><span class="line"></span><br><span class="line">os_operator</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kaichu.se/2020/04/08/airflow-execution-time-and-dag-parsing-time/" data-id="ckdjv3204000gp2c920ryfhbm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bigdata/" rel="tag">bigdata</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/datalake/" rel="tag">datalake</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scheduler/" rel="tag">scheduler</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ways-to-add-tasks-to-ansible-playbook" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/19/ways-to-add-tasks-to-ansible-playbook/" class="article-date">
  <time datetime="2019-12-19T16:28:39.000Z" itemprop="datePublished">2019-12-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Ansible/">Ansible</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/19/ways-to-add-tasks-to-ansible-playbook/">Ways to add tasks to ansible playbook</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Going through official website for beginner is somehow difficult and confused, since ansible provides a few slightly different ways to add tasks to<br>playbook. As a software developer, I always think this is not make users’s world better, in contrast, which makes it hard to work.<br>My opinion is that </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Giving a unique interface will make users much more easier than giving freedom to do the same thing in a few ways.</span><br></pre></td></tr></table></figure>

<p>In this post, I’m summerizing 4 ways of adding tasks to ansible book. I do recommand that u shouldn’t mix them too much. </p>
<h1 id="1-Tasks"><a href="#1-Tasks" class="headerlink" title="1 Tasks"></a>1 Tasks</h1><h2 id="1-1-Use-tasks-with-key-values"><a href="#1-1-Use-tasks-with-key-values" class="headerlink" title="1.1 Use tasks with key-values"></a>1.1 Use tasks with key-values</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  tasks:</span><br><span class="line">  - name: make sure apache is running</span><br><span class="line">    service:</span><br><span class="line">      name: httpd</span><br><span class="line">      state: started</span><br></pre></td></tr></table></figure>
<h2 id="1-2-Use-tasks-with-module-argument-lists"><a href="#1-2-Use-tasks-with-module-argument-lists" class="headerlink" title="1.2 Use tasks with module argument lists"></a>1.2 Use tasks with module argument lists</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  tasks:</span><br><span class="line">  - name: run this command and ignore the result</span><br><span class="line">    shell: &#x2F;usr&#x2F;bin&#x2F;somecommand || &#x2F;bin&#x2F;true</span><br></pre></td></tr></table></figure>
<h2 id="1-3-Use-tasks-with-import-tasks"><a href="#1-3-Use-tasks-with-import-tasks" class="headerlink" title="1.3 Use tasks with import_tasks"></a>1.3 Use tasks with import_tasks</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  tasks:</span><br><span class="line">  - name: run this command and ignore the result</span><br><span class="line">    import_tasks: sometask.yaml</span><br></pre></td></tr></table></figure>
<p>The command and shell modules are the only modules that just take a list of arguments and don’t use the key=value form</p>
<h1 id="2-Roles"><a href="#2-Roles" class="headerlink" title="2 Roles"></a>2 Roles</h1><h2 id="2-1-Use-roles-with-simple-name"><a href="#2-1-Use-roles-with-simple-name" class="headerlink" title="2.1 Use roles with simple name"></a>2.1 Use roles with simple name</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  roles:</span><br><span class="line">    - common</span><br></pre></td></tr></table></figure>
<h2 id="2-2-Use-roles-with-full-key-values"><a href="#2-2-Use-roles-with-full-key-values" class="headerlink" title="2.2 Use roles with full key-values"></a>2.2 Use roles with full key-values</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  roles:</span><br><span class="line">  - role: common</span><br><span class="line">    vars:</span><br><span class="line">       dir: &#39;&#x2F;opt&#x2F;a&#39;</span><br></pre></td></tr></table></figure>
<p>In 2.2, we add the key - role explicitly.</p>
<h1 id="3-Task-Role-Ansible-2-4"><a href="#3-Task-Role-Ansible-2-4" class="headerlink" title="3. Task Role (Ansible 2.4)"></a>3. Task Role (Ansible 2.4)</h1><p>Using import_role or include_role to add tasks in the target role, [Difference between import and include] (<a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse.html#dynamic-vs-static">https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse.html#dynamic-vs-static</a>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  tasks:  &#x2F;&#x2F; Here is tasks, not roles compared to section 2</span><br><span class="line">  - import_role:</span><br><span class="line">      name: example</span><br><span class="line">  - include_role:</span><br><span class="line">      name: example</span><br><span class="line">    vars:</span><br><span class="line">      dir: &#39;&#x2F;opt&#x2F;a&#39;</span><br></pre></td></tr></table></figure>

<h1 id="4-Import-a-whole-playbook"><a href="#4-Import-a-whole-playbook" class="headerlink" title="4. Import a whole playbook"></a>4. Import a whole playbook</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- name: Include a play after another play &#x2F;&#x2F; here is top level of playbook</span><br><span class="line">  import_playbook: otherplays.yaml </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;otherplays.yaml</span><br><span class="line">---</span><br><span class="line">- hosts: webservers</span><br><span class="line">  tasks:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h1 id="5-References"><a href="#5-References" class="headerlink" title="5. References"></a>5. References</h1><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html">https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html</a><br><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html">https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kaichu.se/2019/12/19/ways-to-add-tasks-to-ansible-playbook/" data-id="ckdjv3202000ep2c9gni04do2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ansible-playbook-ansible-roles-ansible-tasks/" rel="tag">ansible-playbook ansible-roles ansible-tasks</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-scripts-to-backup-rancher" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/17/scripts-to-backup-rancher/" class="article-date">
  <time datetime="2019-12-17T16:28:39.000Z" itemprop="datePublished">2019-12-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Rancher/">Rancher</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/17/scripts-to-backup-rancher/">Scripts to backup your rancher container</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Following <a target="_blank" rel="noopener" href="https://rancher.com/docs/rancher/v2.x/en/backups/backups/single-node-backups/">rancher official website</a>,I have created a script to backup. It will stop rancher, backup with busy_box to current working dir and then restart the container again.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.&#x2F;backup_rancher.sh rancher&#x2F;rancher:v2.3.2</span><br></pre></td></tr></table></figure>
<p>The parameter rancher/rancher:v2.3.2 is depending on value on the field of IMAGE in your $docker ps </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE                    COMMAND            ...</span><br><span class="line">b9ad26b8ece5        rancher&#x2F;rancher:v2.3.2   &quot;entrypoint.sh&quot;    ...</span><br></pre></td></tr></table></figure>

<p>// backup_rancher.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash </span><br><span class="line">set -u</span><br><span class="line">set -e </span><br><span class="line"></span><br><span class="line">function backup() &#123;</span><br><span class="line">  rancher_image&#x3D;$1</span><br><span class="line">  rancher_container_name&#x3D;$2</span><br><span class="line">  rancher_container_tag&#x3D;$3</span><br><span class="line">  rancher_backup_date&#x3D;&quot;$(date &#39;+%Y-%m-%d-%H-%M-%S&#39;)&quot;</span><br><span class="line"></span><br><span class="line">  rancher_backup_container_name&#x3D;&quot;rancher-data-$rancher_backup_date&quot;</span><br><span class="line">  rancher_backup_filename&#x3D;&quot;rancher-data-backup-$rancher_container_tag-$rancher_backup_date.tar.gz&quot;</span><br><span class="line"></span><br><span class="line">  echo &quot;...Stoping target rancher container $rancher_container_name&quot;</span><br><span class="line">  docker stop &quot;$rancher_container_name&quot;</span><br><span class="line">  </span><br><span class="line">  echo &quot;...Creating util container and starting backup&quot;</span><br><span class="line">  docker create --volumes-from &quot;$rancher_container_name&quot; --name &quot;$rancher_backup_container_name&quot; &quot;$rancher_image&quot;</span><br><span class="line">  docker run --volumes-from &quot;$rancher_backup_container_name&quot; -v &quot;&#x2F;$PWD&quot;:&#x2F;&#x2F;backup:z &quot;$docker_repository&#x2F;busybox&quot; tar zcvf &#x2F;&#x2F;backup&#x2F;$rancher_backup_filename &#x2F;&#x2F;var&#x2F;lib&#x2F;rancher</span><br><span class="line">  </span><br><span class="line">  echo &quot;...Removing backup util container $rancher_backup_container_name&quot;</span><br><span class="line">  docker rm -f &quot;$rancher_backup_container_name&quot; </span><br><span class="line">  </span><br><span class="line">  echo &quot;...Restarting target rancher container $rancher_container_name&quot;</span><br><span class="line">  docker start &quot;$rancher_container_name&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function main() &#123;</span><br><span class="line">  ancestor_filter&#x3D;$1</span><br><span class="line">  </span><br><span class="line">  for rancher in $(docker ps --filter status&#x3D;running --filter ancestor&#x3D;$ancestor_filter --format &#39;&#123;&#123;.Image&#125;&#125;|&#123;&#123;.Names&#125;&#125;&#39;) </span><br><span class="line">  do</span><br><span class="line">    echo &quot;Found running rancher container $rancher&quot;</span><br><span class="line">    IFS&#x3D;&#39;|&#39; read -ra rancherArr &lt;&lt;&lt; $rancher</span><br><span class="line">    IFS&#x3D;&#39; &#39; </span><br><span class="line">    docker_image&#x3D;&quot;$&#123;rancherArr[0]&#125;&quot;</span><br><span class="line">    docker_names&#x3D;&quot;$&#123;rancherArr[1]&#125;&quot;</span><br><span class="line">    </span><br><span class="line">    echo &quot;...Resolving docker image tag from $docker_image&quot;</span><br><span class="line">    docker_image_tag&#x3D;&#39;latest&#39;</span><br><span class="line">    docker_image_repository&#x3D;&quot;$&#123;docker_image&#125;&quot;</span><br><span class="line">    if [[ &quot;$&#123;docker_image&#125;&quot; &#x3D;~ ^(.*):(.*) ]] </span><br><span class="line">    then </span><br><span class="line">      docker_image_repository&#x3D;&quot;$&#123;BASH_REMATCH[1]&#125;&quot;</span><br><span class="line">      docker_image_tag&#x3D;&quot;$&#123;BASH_REMATCH[2]&#125;&quot;</span><br><span class="line">      echo &quot;Resolved image repository: $docker_image_repository, tag: $docker_image_tag&quot;</span><br><span class="line">    else </span><br><span class="line">      echo &quot;No match tag found, use default tag $docker_image_tag&quot;</span><br><span class="line">    fi</span><br><span class="line">    backup $docker_image $docker_names $docker_image_tag</span><br><span class="line">  done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Change to your proxy registry if you are behind a proxy</span><br><span class="line">docker_repository&#x3D;&quot;registry.hub.docker.com&#x2F;library&quot;</span><br><span class="line"></span><br><span class="line">main &quot;$@&quot;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kaichu.se/2019/12/17/scripts-to-backup-rancher/" data-id="ckdjv31zz000ap2c9dq0adwev" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/backup/" rel="tag">backup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cloud/" rel="tag">cloud</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rancher/" rel="tag">rancher</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-a-story-and-a-piece-of-code-to-understand-nodejs-event-loop" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/29/a-story-and-a-piece-of-code-to-understand-nodejs-event-loop/" class="article-date">
  <time datetime="2019-11-29T15:00:54.000Z" itemprop="datePublished">2019-11-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Nodejs/">Nodejs</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/29/a-story-and-a-piece-of-code-to-understand-nodejs-event-loop/">A story and a piece of code to understand nodejs event loop</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="A-story"><a href="#A-story" class="headerlink" title="A story"></a>A story</h1><p>Imagine the code you want to run is a king and node is the army of servants.<br>The day starts by one servant waking up the king and asking him if he needs anything. The king gives the servant a list of tasks and goes back to sleep a little longer. The servant now distributes those tasks among his colleagues and they get to work.<br>Once a servant finishes a task, he lines up outside the kings quarter to report. The king lets one servant in at a time, and listens to things he reports. Sometimes the king will give the servant more tasks on the way out.<br>Life is good, for the king’s servants carry out all of his tasks in parallel, but only report with one result at a time, so the king can focus.</p>
<h1 id="Callback-programming-model-in-nodejs"><a href="#Callback-programming-model-in-nodejs" class="headerlink" title="Callback programming model in nodejs"></a>Callback programming model in nodejs</h1><p>Request an action and register a callback which will be called when the action has been done.<br>The first request is from node main.js, </p>
<ol>
<li>all function calls will be done in the current phase</li>
<li>any async function call (await on async, async.then) will register a callback in the pending callbacks queue</li>
<li>any timer will be registered in the timers queue</li>
<li>any I/O events from OS level will be listened in poll phases, (timeout and count limitation) </li>
<li>any setImmediate will be run in check, right after next event loop</li>
<li>any close callbacks </li>
<li>checks if it is waiting for any asynchronous I/O or timers and shuts down cleanly if there are not any</li>
<li>nextTickQueue will be processed after the current operation is completed, regardless of the current phase of the event loop</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   ┌───────────────────────────┐</span><br><span class="line">┌─&gt;│           timers          │</span><br><span class="line">│  └─────────────┬─────────────┘</span><br><span class="line">│  ┌─────────────┴─────────────┐</span><br><span class="line">│  │     pending callbacks     │</span><br><span class="line">│  └─────────────┬─────────────┘</span><br><span class="line">│  ┌─────────────┴─────────────┐</span><br><span class="line">│  │       idle, prepare       │</span><br><span class="line">│  └─────────────┬─────────────┘      ┌───────────────┐</span><br><span class="line">│  ┌─────────────┴─────────────┐      │   incoming:   │</span><br><span class="line">│  │           poll            │&lt;─────┤  connections, │</span><br><span class="line">│  └─────────────┬─────────────┘      │   data, etc.  │</span><br><span class="line">│  ┌─────────────┴─────────────┐      └───────────────┘</span><br><span class="line">│  │           check           │</span><br><span class="line">│  └─────────────┬─────────────┘</span><br><span class="line">│  ┌─────────────┴─────────────┐</span><br><span class="line">└──┤      close callbacks      │</span><br><span class="line">   └───────────────────────────┘</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="nextTick-setImmediate-and-setTimeout"><a href="#nextTick-setImmediate-and-setTimeout" class="headerlink" title="nextTick, setImmediate and setTimeout"></a>nextTick, setImmediate and setTimeout</h1><p>A function passed to process.nextTick() is going to be executed on the current iteration of the event loop, after the current operation ends.<br>Any function passed as the setImmediate() argument is a callback that’s executed in the next iteration of the event loop.<br>Any function passed as the setTimeout() argument is a callback that’s executed in the next iteration of the event loop if the time duration has been met</p>
<h1 id="Show-me-the-code"><a href="#Show-me-the-code" class="headerlink" title="Show me the code"></a>Show me the code</h1><p>I create a js file and show u how it works. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">async function bunchWorkAsync() &#123;</span><br><span class="line">    for (let x &#x3D; 0; x &lt; 20; x++) &#123;</span><br><span class="line">        setImmediate(() &#x3D;&gt; console.log(&quot;set immediate&quot; + x));</span><br><span class="line">        setTimeout(() &#x3D;&gt; console.log(&quot;set timeout&quot; + x), 0);</span><br><span class="line">        new Promise((resolve, reject) &#x3D;&gt; &#123; console.log(&#39;current phase&#39;); resolve(&#39;promise callback &#39; + x) &#125;).then(v &#x3D;&gt; console.log(v)).catch(r &#x3D;&gt; console.log(r));</span><br><span class="line">        process.nextTick(() &#x3D;&gt; &#123; console.log(&quot;set nexttick&quot; + x) &#125;);</span><br><span class="line">        console.log(&#39;register &#39; + x)</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(&#39;current phase is started &gt;&gt;&gt;&gt;&gt;&gt; &#39;); </span><br><span class="line">bunchWorkAsync().then(v &#x3D;&gt; console.log(v+ &#39; is resolved in the end of callback queue&#39;));</span><br><span class="line">setImmediate(() &#x3D;&gt; console.log(&quot;set immediate in the end&quot;));</span><br><span class="line">console.log(&#39;current phase is done &gt;&gt;&gt;&gt;&gt;&gt; &#39;);</span><br></pre></td></tr></table></figure>
<p>when I run the js file, event loop starts to work with my current function(node file.js will run all sync and async functions and register all async callbacks in some queues)<br>So the running sequence will be explained as following:</p>
<ol>
<li>console.log<br>console.log(‘current phase is started &gt;&gt;&gt;&gt;&gt;&gt; ‘); </li>
<li>bunchWorkAsync()<br>we go into the loop,</li>
<li>1 setImmediate(() =&gt; console.log(“set immediate” + x));<br>we register a callback in the check phase in next event loop</li>
<li>2 setTimeout(() =&gt; console.log(“set timeout” + x), 0);<br>we register a callback in the timers in next event loop</li>
<li>3 new Promise((resolve, reject) …)<br>Run console.log(‘current phase’)<br>we register a callback by Promise(same as a async function) in the callback phase</li>
<li>4  process.nextTick(() =&gt; { console.log(“set nexttick” + x) });<br>we register a callback right after the current operation is done, should be run in current event loop</li>
<li>5 console.log(‘register ‘ + x)<br>we run the log in current phase</li>
<li>6 return 0, since we run the bunchWorkAsync with callback<br>we register a callback in next event loop </li>
<li>setImmediate(() =&gt; console.log(“set immediate in the end”));<br>we add a callback in the check phase in next event loop</li>
<li>console.log(‘current phase is done &gt;&gt;&gt;&gt;&gt;&gt; ‘);<br>we run the command in current operation</li>
</ol>
<p>Then we can think everything in the event loop as following<br>Current loop</p>
<ol>
<li>current operation<br>running all command</li>
<li>next tick queue<br>20 callbacks setup by process.nextTick(() =&gt; { console.log(“set nexttick” + x) });</li>
</ol>
<p>Next event loop</p>
<ol>
<li>timers queue<br>20 callbacks setup by setTimeout()</li>
<li>pending callbacks queue<br>20 callbacks setup by new Promise().then()<br>1 callback setup by bunchWorkAsync().then()</li>
<li>check<br>20 callbacks setup by setImmediate()<br>1 callback setup by setImmediate(() =&gt; console.log(“set immediate in the end”));</li>
</ol>
<p>So in theory, in the end, you should expect the running sequence as following<br>1 current phase output<br>current phase is started &gt;&gt;&gt;&gt;&gt;&gt;<br>20 times ‘current phase’<br>20 times ‘register ‘ + x<br>current phase is done &gt;&gt;&gt;&gt;&gt;&gt;<br>2. nextTick<br>20 times ‘set nexttick’ + x<br>3. timers<br>queues stay<br>4. callbacks queue<br>20 times ‘promise callback’<br>v+ ‘ is resolved in the end of callback queue’<br>5. poll<br>hi OS, I tell u to print my logs, it takes 20ms;<br>OS said yes. it takes 2ms to get the message into node. (I think callback run in libuv?)<br>after 22ms …<br>Oh yeah, I need to check with timers, they may ask to do something now<br>Of course,<br>20 times ‘set timeout’ is in the queue for a while<br>jump into timers tasks</p>
<ol start="5">
<li>check phase<br>20 times ‘set immediate’<br>set immediate in the end</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">$ node examples&#x2F;event-loop.js</span><br><span class="line">current phase is started &gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">current phase</span><br><span class="line">register 0</span><br><span class="line">current phase</span><br><span class="line">register 1</span><br><span class="line">current phase</span><br><span class="line">register 2</span><br><span class="line">current phase</span><br><span class="line">register 3</span><br><span class="line">current phase</span><br><span class="line">register 4</span><br><span class="line">current phase</span><br><span class="line">register 5</span><br><span class="line">current phase</span><br><span class="line">register 6</span><br><span class="line">current phase</span><br><span class="line">register 7</span><br><span class="line">current phase</span><br><span class="line">register 8</span><br><span class="line">current phase</span><br><span class="line">register 9</span><br><span class="line">current phase</span><br><span class="line">register 10</span><br><span class="line">current phase</span><br><span class="line">register 11</span><br><span class="line">current phase</span><br><span class="line">register 12</span><br><span class="line">current phase</span><br><span class="line">register 13</span><br><span class="line">current phase</span><br><span class="line">register 14</span><br><span class="line">current phase</span><br><span class="line">register 15</span><br><span class="line">current phase</span><br><span class="line">register 16</span><br><span class="line">current phase</span><br><span class="line">register 17</span><br><span class="line">current phase</span><br><span class="line">register 18</span><br><span class="line">current phase</span><br><span class="line">register 19</span><br><span class="line">current phase is done &gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">set nexttick0</span><br><span class="line">set nexttick1</span><br><span class="line">set nexttick2</span><br><span class="line">set nexttick3</span><br><span class="line">set nexttick4</span><br><span class="line">set nexttick5</span><br><span class="line">set nexttick6</span><br><span class="line">set nexttick7</span><br><span class="line">set nexttick8</span><br><span class="line">set nexttick9</span><br><span class="line">set nexttick10</span><br><span class="line">set nexttick11</span><br><span class="line">set nexttick12</span><br><span class="line">set nexttick13</span><br><span class="line">set nexttick14</span><br><span class="line">set nexttick15</span><br><span class="line">set nexttick16</span><br><span class="line">set nexttick17</span><br><span class="line">set nexttick18</span><br><span class="line">set nexttick19</span><br><span class="line">promise callback 0</span><br><span class="line">promise callback 1</span><br><span class="line">promise callback 2</span><br><span class="line">promise callback 3</span><br><span class="line">promise callback 4</span><br><span class="line">promise callback 5</span><br><span class="line">promise callback 6</span><br><span class="line">promise callback 7</span><br><span class="line">promise callback 8</span><br><span class="line">promise callback 9</span><br><span class="line">promise callback 10</span><br><span class="line">promise callback 11</span><br><span class="line">promise callback 12</span><br><span class="line">promise callback 13</span><br><span class="line">promise callback 14</span><br><span class="line">promise callback 15</span><br><span class="line">promise callback 16</span><br><span class="line">promise callback 17</span><br><span class="line">promise callback 18</span><br><span class="line">promise callback 19</span><br><span class="line">0 is resolved in the end of callback queue</span><br><span class="line">set timeout0</span><br><span class="line">set timeout1</span><br><span class="line">set timeout2</span><br><span class="line">set timeout3</span><br><span class="line">set timeout4</span><br><span class="line">set timeout5</span><br><span class="line">set timeout6</span><br><span class="line">set timeout7</span><br><span class="line">set timeout8</span><br><span class="line">set timeout9</span><br><span class="line">set timeout10</span><br><span class="line">set timeout11</span><br><span class="line">set timeout12</span><br><span class="line">set timeout13</span><br><span class="line">set timeout14</span><br><span class="line">set timeout15</span><br><span class="line">set timeout16</span><br><span class="line">set timeout17</span><br><span class="line">set timeout18</span><br><span class="line">set timeout19</span><br><span class="line">set immediate0</span><br><span class="line">set immediate1</span><br><span class="line">set immediate2</span><br><span class="line">set immediate3</span><br><span class="line">set immediate4</span><br><span class="line">set immediate5</span><br><span class="line">set immediate6</span><br><span class="line">set immediate7</span><br><span class="line">set immediate8</span><br><span class="line">set immediate9</span><br><span class="line">set immediate10</span><br><span class="line">set immediate11</span><br><span class="line">set immediate12</span><br><span class="line">set immediate13</span><br><span class="line">set immediate14</span><br><span class="line">set immediate15</span><br><span class="line">set immediate16</span><br><span class="line">set immediate17</span><br><span class="line">set immediate18</span><br><span class="line">set immediate19</span><br><span class="line">set immediate in the end</span><br></pre></td></tr></table></figure>

<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a target="_blank" rel="noopener" href="https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick">nodejs event loop</a> </li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/45566463/node-js-event-loop-understanding-with-a-diagram">a storty</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kaichu.se/2019/11/29/a-story-and-a-piece-of-code-to-understand-nodejs-event-loop/" data-id="ckdjv31zy0009p2c9a05cdeei" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Promise/" rel="tag">Promise</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event-loop/" rel="tag">event loop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/setImmediate/" rel="tag">setImmediate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/setTimeout/" rel="tag">setTimeout</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Airflow/">Airflow</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ansible/">Ansible</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nodejs/">Nodejs</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS/">OS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Rancher/">Rancher</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reactjs/">Reactjs</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Site/">Site</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Isomorphic/" rel="tag">Isomorphic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Promise/" rel="tag">Promise</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPA/" rel="tag">SPA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/airflow/" rel="tag">airflow</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/" rel="tag">ansible</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible-playbook-ansible-roles-ansible-tasks/" rel="tag">ansible-playbook ansible-roles ansible-tasks</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/architecture/" rel="tag">architecture</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/" rel="tag">authentication</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backup/" rel="tag">backup</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/" rel="tag">bash</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bigdata/" rel="tag">bigdata</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/" rel="tag">blog</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloud/" rel="tag">cloud</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/component/" rel="tag">component</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/datalake/" rel="tag">datalake</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/" rel="tag">devops</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/event-loop/" rel="tag">event loop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/frontend/" rel="tag">frontend</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hypervisors/" rel="tag">hypervisors</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jinja/" rel="tag">jinja</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kvm/" rel="tag">kvm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openldap/" rel="tag">openldap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qemu/" rel="tag">qemu</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rancher/" rel="tag">rancher</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scheduler/" rel="tag">scheduler</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/setImmediate/" rel="tag">setImmediate</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/setTimeout/" rel="tag">setTimeout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/site/" rel="tag">site</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/starter/" rel="tag">starter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/" rel="tag">tools</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtulization/" rel="tag">virtulization</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Isomorphic/" style="font-size: 10px;">Isomorphic</a> <a href="/tags/Promise/" style="font-size: 10px;">Promise</a> <a href="/tags/SPA/" style="font-size: 10px;">SPA</a> <a href="/tags/airflow/" style="font-size: 10px;">airflow</a> <a href="/tags/ansible/" style="font-size: 20px;">ansible</a> <a href="/tags/ansible-playbook-ansible-roles-ansible-tasks/" style="font-size: 10px;">ansible-playbook ansible-roles ansible-tasks</a> <a href="/tags/architecture/" style="font-size: 10px;">architecture</a> <a href="/tags/authentication/" style="font-size: 10px;">authentication</a> <a href="/tags/backup/" style="font-size: 10px;">backup</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/bigdata/" style="font-size: 20px;">bigdata</a> <a href="/tags/blog/" style="font-size: 20px;">blog</a> <a href="/tags/cloud/" style="font-size: 10px;">cloud</a> <a href="/tags/component/" style="font-size: 10px;">component</a> <a href="/tags/datalake/" style="font-size: 20px;">datalake</a> <a href="/tags/devops/" style="font-size: 10px;">devops</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/event-loop/" style="font-size: 10px;">event loop</a> <a href="/tags/frontend/" style="font-size: 20px;">frontend</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/hypervisors/" style="font-size: 10px;">hypervisors</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/jinja/" style="font-size: 10px;">jinja</a> <a href="/tags/kvm/" style="font-size: 10px;">kvm</a> <a href="/tags/nodejs/" style="font-size: 20px;">nodejs</a> <a href="/tags/openldap/" style="font-size: 10px;">openldap</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/qemu/" style="font-size: 10px;">qemu</a> <a href="/tags/rancher/" style="font-size: 10px;">rancher</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/reactjs/" style="font-size: 10px;">reactjs</a> <a href="/tags/scheduler/" style="font-size: 10px;">scheduler</a> <a href="/tags/setImmediate/" style="font-size: 10px;">setImmediate</a> <a href="/tags/setTimeout/" style="font-size: 10px;">setTimeout</a> <a href="/tags/site/" style="font-size: 10px;">site</a> <a href="/tags/starter/" style="font-size: 10px;">starter</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/virtulization/" style="font-size: 10px;">virtulization</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/08/07/what-is-apache-airflow/">What is apache airflow</a>
          </li>
        
          <li>
            <a href="/2020/05/12/understand-different-levels-of-hypervisors-beneath-os/">Understand different levels of hypervisors beneath os</a>
          </li>
        
          <li>
            <a href="/2020/05/01/start-a-nodejs-project-and-publish-it-into-public-npm-registry/">Start a nodejs project and publish it into public npm registry</a>
          </li>
        
          <li>
            <a href="/2020/04/25/setup-airflow-with-openldap-authentication-with-docker/">Setup airflow with openldap authentication with docker</a>
          </li>
        
          <li>
            <a href="/2020/04/24/start-a-ansible-project/">Start a ansible project</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>